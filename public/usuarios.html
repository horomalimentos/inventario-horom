<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión Usuarios</title>
  <style>
    body {font-family: Arial; text-align: center; padding: 20px;}
    table {margin: auto; width: 70%; border-collapse: collapse;}
    th, td {border: 1px solid #ccc; padding: 8px;}
    input, button {padding: 6px; border-radius: 5px; border: 1px solid #ccc;}
    button {background-color: #3498db; color: white; cursor: pointer; border: none;}
    button:hover {background-color: #2980b9;}
  </style>
</head>
<body>
  <h2>Gestión de Usuarios</h2>

  <input id="nuevoUsuario" placeholder="Usuario">
  <input id="nuevaPass" placeholder="Contraseña" type="password">
  <button onclick="agregar()">Agregar Usuario</button><br><br>

  <table>
    <thead>
      <tr>
        <th>Usuario</th>
        <th>Nueva Contraseña</th>
        <th>Modificar</th>
        <th>Eliminar</th>
      </tr>
    </thead>
    <tbody id="tabla"></tbody>
  </table>

  <script>
    const BASE_URL = "https://inventario-horom-production.up.railway.app";

    async function cargar() {
      try {
        const res = await fetch(`${BASE_URL}/usuarios-registrados`);
        const users = await res.json();
        const tabla = document.getElementById("tabla");
        tabla.innerHTML = users.map(u => `
          <tr>
            <td>${u.usuario}</td>
            <td><input type="password" id="p${u._id}" placeholder="Nueva Contraseña"></td>
            <td><button onclick="modificar('${u._id}')">Modificar</button></td>
            <td><button onclick="eliminar('${u._id}')">Eliminar</button></td>
          </tr>`).join("");
      } catch (error) {
        console.error("Error al cargar usuarios:", error);
      }
    }

    async function agregar() {
      try {
        await fetch(`${BASE_URL}/nuevo-usuario`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            usuario: document.getElementById("nuevoUsuario").value,
            contraseña: document.getElementById("nuevaPass").value
          })
        });
        cargar();
      } catch (error) {
        console.error("Error al agregar usuario:", error);
      }
    }

    async function modificar(id) {
      try {
        await fetch(`${BASE_URL}/modificar-usuario/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contraseña: document.getElementById(`p${id}`).value
          })
        });
        cargar();
      } catch (error) {
        console.error("Error al modificar usuario:", error);
      }
    }

    async function eliminar(id) {
      if (confirm("¿Seguro que quieres eliminar este usuario?")) {
        try {
          await fetch(`${BASE_URL}/eliminar-usuario/${id}`, {
            method: "DELETE"
          });
          cargar();
        } catch (error) {
          console.error("Error al eliminar usuario:", error);
        }
      }
    }

    cargar();
  </script>

</body>
</html>
