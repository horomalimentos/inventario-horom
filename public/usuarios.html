<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de Usuarios</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
    h2 { margin-bottom: 20px; }
    input, button { width: 80%; max-width: 300px; padding: 10px; margin: 5px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
    table { margin: auto; width: 90%; border-collapse: collapse; font-size: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    button { background-color: #3498db; color: white; cursor: pointer; border: none; }
    button:hover { background-color: #2980b9; }
    .btn-danger { background-color: #e74c3c; }
    .btn-danger:hover { background-color: #c0392b; }
    .footer { margin-top: 30px; font-size: 12px; color: gray; }
  </style>
</head>
<body>

<h2>Gesti√≥n de Usuarios üë•</h2>

<input id="nuevoUsuario" placeholder="Nuevo Usuario" autocomplete="off">
<input id="nuevaPass" type="password" placeholder="Nueva Contrase√±a" autocomplete="off">
<br>
<button onclick="agregarUsuario()">‚ûï Agregar Usuario</button>

<br><br>

<table>
  <thead>
    <tr>
      <th>Usuario</th>
      <th>Nueva Contrase√±a</th>
      <th>Modificar</th>
      <th>Eliminar</th>
    </tr>
  </thead>
  <tbody id="tablaUsuarios"></tbody>
</table>

<div class="footer">
  Aplicaci√≥n para administraci√≥n de inventarios para PYMES ‚Äî Alejandro Ornelas Orom Soluciones
</div>

<script>
const server = "https://inventario-horom-production.up.railway.app";

async function cargarUsuarios() {
  try {
    const res = await fetch(`${server}/usuarios-registrados`);
    const usuarios = await res.json();
    const tabla = document.getElementById("tablaUsuarios");
    tabla.innerHTML = usuarios.map(u => `
      <tr>
        <td>${u.usuario}</td>
        <td><input type="password" id="pass-${u._id}" placeholder="Nueva Contrase√±a"></td>
        <td><button onclick="modificarUsuario('${u._id}')">‚úèÔ∏è Modificar</button></td>
        <td><button class="btn-danger" onclick="eliminarUsuario('${u._id}')">üóëÔ∏è Eliminar</button></td>
      </tr>
    `).join("");
  } catch (error) {
    console.error("‚ùå Error al cargar usuarios:", error);
    alert("‚ùå Error al conectar con el servidor");
  }
}

async function agregarUsuario() {
  const usuario = document.getElementById("nuevoUsuario").value.trim();
  const contrase√±a = document.getElementById("nuevaPass").value.trim();
  if (!usuario || !contrase√±a) {
    alert("‚ùå Ambos campos son obligatorios");
    return;
  }
  try {
    await fetch(`${server}/nuevo-usuario`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ usuario, contrase√±a })
    });
    alert("‚úÖ Usuario agregado exitosamente");
    document.getElementById("nuevoUsuario").value = "";
    document.getElementById("nuevaPass").value = "";
    cargarUsuarios();
  } catch (error) {
    console.error("‚ùå Error al agregar usuario:", error);
    alert("‚ùå Error al agregar usuario");
  }
}

async function modificarUsuario(id) {
  const nuevaPass = document.getElementById(`pass-${id}`).value.trim();
  if (!nuevaPass) {
    alert("‚ùå Ingresa una nueva contrase√±a");
    return;
  }
  try {
    await fetch(`${server}/modificar-usuario/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ contrase√±a: nuevaPass })
    });
    alert("‚úÖ Contrase√±a modificada exitosamente");
    cargarUsuarios();
  } catch (error) {
    console.error("‚ùå Error al modificar usuario:", error);
    alert("‚ùå Error al modificar usuario");
  }
}

async function eliminarUsuario(id) {
  if (!confirm("‚ö†Ô∏è ¬øEst√°s seguro de eliminar este usuario?")) return;
  try {
    await fetch(`${server}/eliminar-usuario/${id}`, { method: "DELETE" });
    alert("‚úÖ Usuario eliminado exitosamente");
    cargarUsuarios();
  } catch (error) {
    console.error("‚ùå Error al eliminar usuario:", error);
    alert("‚ùå Error al eliminar usuario");
  }
}

// Cargar usuarios al iniciar
cargarUsuarios();
</script>

</body>
</html>
