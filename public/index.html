<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menú Principal</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; text-align: center; }
    h2 { margin-bottom: 20px; }
    button { width: 90%; max-width: 300px; padding: 12px; margin: 10px 0; font-size: 16px; border: none; border-radius: 5px; background-color: #d9534f; color: white; cursor: pointer; }
    button:hover { background-color: #c9302c; }
    footer { margin-top: 40px; font-size: 12px; color: gray; }
    #loader { display: none; margin-top: 20px; font-size: 14px; color: #555; }
  </style>
</head>
<body>

<h2>Menú Principal</h2>

<div id="loader">Cargando...</div>

<button onclick="irACapturar()">Capturar Inventario</button>
<button onclick="irAVerInventarios()">Ver Inventarios</button>
<button onclick="irACompras()">Compras</button>
<button onclick="cambiarMiContraseña()">Cambiar Mi Contraseña</button>
<button onclick="accederConfiguracion()">Configuración (Protegida)</button>

<footer>
  Aplicación para administración de inventarios para PYMES — Alejandro Ornelas — Orom Soluciones
</footer>

<script>
const SERVER = "https://inventario-horom-production.up.railway.app";
const SUPERCONTRASEÑA = "Pelon93."; // Puedes cambiarla luego desde config

// Validar sesión al entrar
window.onload = function() {
  const sesion = JSON.parse(localStorage.getItem("sesionUsuario"));
  if (!sesion || !sesion.usuario) {
    alert("Debes iniciar sesión.");
    window.location.href = "login.html";
  }
};

function irACapturar() {
  window.location.href = "capturar.html";
}

function irAVerInventarios() {
  window.location.href = "ver-nombres.html";
}

function irACompras() {
  window.location.href = "compras.html";
}

async function cambiarMiContraseña() {
  const actual = prompt("Introduce tu contraseña actual:");
  const sesion = JSON.parse(localStorage.getItem("sesionUsuario"));

  if (!actual || actual.trim() === "") return;

  try {
    const validar = await fetch(`${SERVER}/validar-usuario`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({usuario: sesion.usuario, contraseña: actual})
    });
    const data = await validar.json();

    if (!data.valido) {
      alert("❌ Contraseña incorrecta.");
      return;
    }

    const nueva = prompt("Introduce nueva contraseña (mínimo 4 caracteres):");
    if (!nueva || nueva.length < 4) {
      alert("❌ Nueva contraseña no válida.");
      return;
    }

    await fetch(`${SERVER}/modificar-usuario/${sesion.id}`, {
      method: "PUT",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({contraseña: nueva})
    });

    alert("✅ Contraseña cambiada correctamente.");
  } catch (error) {
    console.error(error);
    alert("❌ Error al cambiar contraseña.");
  }
}

function accederConfiguracion() {
  const clave = prompt("Introduce la supercontraseña:");
  if (clave === SUPERCONTRASEÑA) {
    window.location.href = "configuracion.html";
  } else {
    alert("❌ Supercontraseña incorrecta.");
  }
}
</script>

</body>
</html>
